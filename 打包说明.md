# Windows 一键打包说明

## 简介
这个脚本可以帮助你在 Windows 系统上一键完成从 Python 环境准备到生成 exe 可执行文件的全部过程。

**重要更新：现在自动包含 FFmpeg，生成的 exe 可在干净的 Windows 系统上直接运行！**

## 使用说明

### 方法1：使用完整脚本（推荐）

运行项目根目录下的 `build.bat`：

```bash
build.bat
```

这个脚本会：
1. ✅ 检查是否安装了 Python 3.12（如果没有，自动下载安装）
2. ✅ 自动下载 FFmpeg（约 80MB）并解压
3. ✅ 创建虚拟环境（如果已存在则跳过）
4. ✅ 安装所有依赖包
5. ✅ 使用 PyInstaller 打包成 exe（包含 FFmpeg）
6. ✅ 生成部署说明文档

**特点：**
- 真正的"一键式"操作，无需手动安装任何依赖
- **生成的 exe 可在干净的 Windows 系统上独立运行**
- 首次运行会自动安装 Python 和 FFmpeg
- 重复运行会自动跳过已完成的步骤
- 代码更新后重新运行即可重新打包

### 方法2：使用分步脚本

如果系统已经有 Python 和 FFmpeg，可以使用分步脚本：

1. 首先设置虚拟环境：
   ```bash
   setup_venv.bat
   ```

2. 然后进入 build 目录打包：
   ```bash
   cd build
   build_windows.bat
   ```

## 打包后的文件

打包完成后，会在 `dist` 目录下生成：

```
dist/
├── VideoWatermarkTool.exe      # 主程序（包含所有依赖）
├── _internal/                  # 依赖文件（包含 FFmpeg）
└── README_部署说明.txt          # 使用说明
```

**✨ 生成的 exe 已包含 FFmpeg，无需用户额外安装！**

## 环境要求

### 自动安装的依赖
- ✅ Python 3.12 (自动下载安装)
- ✅ FFmpeg (自动下载安装)
- pip (Python 包管理工具)
- virtualenv (虚拟环境)

### 依赖包
- moviepy>=1.0.3 (视频处理)
- Pillow>=9.0.0 (图像处理)
- numpy>=1.21.0 (数值计算)
- click>=8.0.0 (命令行框架)
- PyQt6>=6.4.0 (图形界面)
- PyInstaller>=5.0 (打包工具)
- imageio-ffmpeg (FFmpeg 封装)

### 无需手动安装的依赖
- ~~FFmpeg~~ (已自动打包到 exe 中)

## 注意事项

1. **首次运行**
   - 需要联网下载 Python 安装包（约 25MB）
   - 需要联网下载 FFmpeg（约 80MB）
   - 安装过程可能需要 5-10 分钟
   - 可能需要管理员权限（安装 Python）

2. **重复运行**
   - 自动跳过 Python 安装（如果已安装）
   - 自动跳过 FFmpeg 下载（如果已存在）
   - 只重新打包应用，节省时间
   - 适合代码更新后重新打包

3. **网络问题**
   - 如果下载失败，脚本会尝试备用下载地址
   - 可以手动下载后放到 resources\ffmpeg 目录

4. **FFmpeg 已成功集成**
   - 自动下载 Windows 版本的 FFmpeg
   - 通过 PyInstaller 打包到 exe 中
   - 用户无需关心 FFmpeg 安装

## 常见问题

### Q: 打包后 exe 可以直接在别的电脑上运行吗？
A: **可以！** 生成的 exe 是独立的，包含所有依赖，包括 FFmpeg。

### Q: 打包后运行提示缺少 DLL 或模块？
A: 尝试以下步骤：
   - 删除 venv 目录重新运行 build.bat
   - 检查 requirements.txt 是否完整
   - 查看 VideoWatermarkTool.spec 的 hiddenimports

### Q: 打包后的 exe 运行很慢？
A: 这是正常的，PyInstaller 打包的 exe 启动时需要解压依赖，通常只需等待几秒钟。

### Q: 如何减小打包体积？
A: 可以编辑 VideoWatermarkTool.spec 文件：
   - 排除不必要的模块
   - 使用 UPX 压缩（已默认启用）
   - 移除不需要的 FFmpeg 组件（如 ffplay）

### Q: 打包时出现 "Module not found" 错误？
A: 将缺失的模块添加到 VideoWatermarkTool.spec 的 hiddenimports 数组中

### Q: 可以在没有网络的电脑上运行吗？
A: 可以！打包后的 exe 不依赖网络，所有组件都已内置。

## 部署说明

### 部署步骤（极简版）
1. 将 `dist` 目录复制到目标 Windows 机器
2. **直接运行** `VideoWatermarkTool.exe` ✨
3. 无需安装任何依赖！

### 部署步骤（单文件版）
如果想只分发单个 exe 文件：
```bash
# 编辑 VideoWatermarkTool.spec，修改 EXE 部分的配置
# 设置为单文件模式（console=True 改为 console=False 可隐藏命令行窗口）

# 重新打包
cd build
build_windows.bat
```

### 包含的内容
建议将以下内容一起打包：
- VideoWatermarkTool.exe
- _internal/ 目录（所有依赖）
- README_部署说明.txt

## 技术支持

如有问题，请检查：
1. 是否从 dist 目录完整复制所有文件
2. 不要删除 _internal 文件夹
3. Windows 版本是否兼容（需要 Windows 7 或更高）
4. 查看 dist 目录下的 README_部署说明.txt

## 系统要求

- **操作系统**: Windows 7 或更高版本
- **架构**: x64 (64位)
- **内存**: 至少 4GB RAM（处理大视频时需要更多）
- **存储**: 至少 500MB 可用空间
- **其他**: 无需安装 .NET Framework 或其他运行时

## 许可证

本项目使用 PyInstaller 进行打包，遵循相应许可证规定。FFmpeg 遵循 GPL/LGPL 许可证。
